<html>

<head>
<title>Maven Dispatcher</title>
<link rel='stylesheet' href='/webjars/bootstrap/css/bootstrap.min.css'>
</head>

<body>
	<div class="container">
		<div class="row">
			<div class="col-4">
				<h1 class="display-4">Maven Dispatcher</h1>
				<ul class="nav flex-column">
					<li class="nav-item"><a class="nav-link" href="#"
						id="homeButton">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="#"
						id="hostButton">Hosts</a></li>
					<li class="nav-item"><a class="nav-link" href="#"
						id="jobsButton">Jobs</a></li>
					<li class="nav-item"><a class="nav-link" href="./upload.html">New Job</a></li>						
				</ul>
			</div>
			<div class="col-8 align-self-center">
				<h3 class="lead" id="viewName">Home</h3>
				<table id="datatable" class="table"></table>
			</div>
		</div>
	</div>
	<script src="/webjars/jquery/jquery.min.js"></script>
	<script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
	<script>
	
		$('#homeButton').click(function(e) {
			$('#viewName').text('Home');
			$('#datatable').empty();
		});

		$('#hostButton').click(function(e) {
			$('#viewName').text('Hosts');
			$('#datatable').empty();
			$.ajax({
				url : '/api/host',
				method : 'GET',
				dataType : 'json',
				success : function(data) {
					var header = false;
					$.each(data,function(k,v) {
						var headerRow = null;
						var row = "<tr>";
						if (!header) {
							headerRow = "<tr>";							
						}//end if
						$.each(v,function(n,val){
							if (!header) {
								headerRow += "<th>";
								headerRow += n;
								headerRow += "</th>";
							}//end if
							row += "<td>";
							row += val;
							row += "</td>";
						});
						if (!header) {
							headerRow += "</tr>";
							$('#datatable').append(headerRow);
							header = true;
						}//end if
						row += "</tr>";
						$('#datatable').append(row);
					});
				}
			});
		});

		$('#jobsButton').click(function(e) {
			$('#viewName').text('Jobs');
			$('#datatable').empty();
			$.ajax({
				url : '/api/runner',
				method : 'GET',
				dataType : 'json',
				success : function(data) {
 					var header = false;
					$.each(data,function(k,v) {
						var headerRow = null;
						var row = "<tr>";
						if (!header) {
							headerRow = "<tr>";							
						}//end if
						$.each(v,function(n,val){
							if (!header) {
								headerRow += "<th>";
								headerRow += n;
								headerRow += "</th>";
							}//end if
							row += "<td>";
							if (typeof val == "object") {
								row += val.address;
								row += ":";
								row += val.port;
							} else if (n == "uuid") {
								row += "<a href='/api/runner/";
								row += val;
								row += "/log'>Download Log</a>";
							} else if (n == "successful" && val == false) {
								row += "<strong style='color:red;'>";
								row += val;
								row += "</strong>";
							} else if (n == "successful" && val == true) {
								row += "<strong style='color:green;'>";
								row += val;
								row += "</strong>";								
							} else {
								row += val;	
							}//end if
							row += "</td>";
						});
						if (!header) {
							headerRow += "</tr>";
							$('#datatable').append(headerRow);
							header = true;
						}//end if
						row += "</tr>";
						$('#datatable').append(row);
					});
				}
			});			
		});
	</script>
</body>

</html>
